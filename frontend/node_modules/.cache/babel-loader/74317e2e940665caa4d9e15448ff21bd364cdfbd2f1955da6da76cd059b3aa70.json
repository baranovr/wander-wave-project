{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nconst initialState = {\n  accessToken: localStorage.getItem('access_token'),\n  refreshToken: localStorage.getItem('refresh_token'),\n  loading: false,\n  error: null,\n  isAuthenticated: false\n};\nconst instance = axios.create({\n  baseURL: import.meta.env.VITE_API_URL\n});\nexport const login = createAsyncThunk('auth/login', async ({\n  username,\n  password\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post('http://127.0.0.1:8080/api/user/token/', {\n      username,\n      password\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Login failed');\n  }\n});\nexport const refreshToken = createAsyncThunk('auth/refreshToken', async (_, {\n  getState,\n  rejectWithValue\n}) => {\n  const state = getState();\n  const refreshToken = state.auth.refreshToken;\n  try {\n    const response = await axios.post('api/user/token/refresh/', {\n      refresh: refreshToken\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Token refresh failed');\n  }\n});\nexport const logout = createAsyncThunk('auth/logout', async (_, {\n  getState,\n  rejectWithValue\n}) => {\n  const state = getState();\n  const refreshToken = state.auth.refreshToken;\n  try {\n    const response = await axios.post('/api/user/my_profile/logout/', {\n      refresh_token: refreshToken\n    });\n    if (response.status === 205) {\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      return;\n    } else {\n      return rejectWithValue('Logout failed');\n    }\n  } catch (error) {\n    return rejectWithValue('Logout failed');\n  }\n});\nexport const register = createAsyncThunk('auth/register', async (registrationData, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post('/api/user/register/', registrationData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Registration failed');\n  }\n});\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    clearAuthState(state) {\n      state.accessToken = null;\n      state.refreshToken = null;\n      state.loading = false;\n      state.error = null;\n      state.isAuthenticated = false;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(login.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(login.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n      state.isAuthenticated = true;\n    }).addCase(login.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(refreshToken.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(refreshToken.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n    }).addCase(refreshToken.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(logout.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(logout.fulfilled, state => {\n      state.loading = false;\n      state.accessToken = null;\n      state.refreshToken = null;\n      state.isAuthenticated = false;\n    }).addCase(logout.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(register.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(register.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n      state.isAuthenticated = true;\n    }).addCase(register.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    });\n  }\n});\nexport const {\n  clearAuthState\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","initialState","accessToken","localStorage","getItem","refreshToken","loading","error","isAuthenticated","instance","create","baseURL","import","meta","env","VITE_API_URL","login","username","password","rejectWithValue","response","post","access","refresh","data","setItem","_","getState","state","auth","logout","refresh_token","status","removeItem","register","registrationData","headers","authSlice","name","reducers","clearAuthState","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["D:/pycharm_projects/wander-wave-project/frontend/src/features/authSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n\r\ninterface AuthState {\r\n  accessToken: string | null;\r\n  refreshToken: string | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  isAuthenticated: boolean;\r\n}\r\n\r\nconst initialState: AuthState = {\r\n  accessToken: localStorage.getItem('access_token'),\r\n  refreshToken: localStorage.getItem('refresh_token'),\r\n  loading: false,\r\n  error: null,\r\n  isAuthenticated: false,\r\n};\r\n\r\ntype registerData = {\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  status: string;\r\n  about_me: string;\r\n  avatar: string;\r\n};\r\n\r\nconst instance = axios.create({\r\n  baseURL: import.meta.env.VITE_API_URL,\r\n});\r\n\r\nexport const login = createAsyncThunk(\r\n  'auth/login',\r\n  async (\r\n    { username, password }: { username: string; password: string },\r\n    { rejectWithValue },\r\n  ) => {\r\n    try {\r\n      const response = await axios.post('http://127.0.0.1:8080/api/user/token/', { username, password });\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Login failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const refreshToken = createAsyncThunk(\r\n  'auth/refreshToken',\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState() as { auth: AuthState };\r\n    const refreshToken = state.auth.refreshToken;\r\n\r\n    try {\r\n      const response = await axios.post('api/user/token/refresh/', {\r\n        refresh: refreshToken,\r\n      });\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Token refresh failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const logout = createAsyncThunk(\r\n  'auth/logout',\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState() as { auth: AuthState };\r\n    const refreshToken = state.auth.refreshToken;\r\n\r\n    try {\r\n      const response = await axios.post('/api/user/my_profile/logout/', {\r\n        refresh_token: refreshToken,\r\n      });\r\n      if (response.status === 205) {\r\n        localStorage.removeItem('access_token');\r\n        localStorage.removeItem('refresh_token');\r\n        return;\r\n      } else {\r\n        return rejectWithValue('Logout failed');\r\n      }\r\n    } catch (error) {\r\n      return rejectWithValue('Logout failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const register = createAsyncThunk(\r\n  'auth/register',\r\n  async (registrationData: registerData, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.post(\r\n        '/api/user/register/',\r\n        registrationData,\r\n        {\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n          },\r\n        },\r\n      );\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Registration failed');\r\n    }\r\n  },\r\n);\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    clearAuthState(state) {\r\n      state.accessToken = null;\r\n      state.refreshToken = null;\r\n      state.loading = false;\r\n      state.error = null;\r\n      state.isAuthenticated = false;\r\n    },\r\n  },\r\n  extraReducers: builder => {\r\n    builder\r\n      .addCase(login.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        login.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n          state.isAuthenticated = true;\r\n        },\r\n      )\r\n      .addCase(login.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(refreshToken.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        refreshToken.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n        },\r\n      )\r\n      .addCase(refreshToken.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(logout.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(logout.fulfilled, state => {\r\n        state.loading = false;\r\n        state.accessToken = null;\r\n        state.refreshToken = null;\r\n        state.isAuthenticated = false;\r\n      })\r\n      .addCase(logout.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(register.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        register.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n          state.isAuthenticated = true;\r\n        },\r\n      )\r\n      .addCase(register.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { clearAuthState } = authSlice.actions;\r\nexport default authSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}