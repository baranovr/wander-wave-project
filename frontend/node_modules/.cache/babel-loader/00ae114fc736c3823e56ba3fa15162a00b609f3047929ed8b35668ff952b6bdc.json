{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nconst initialState = {\n  accessToken: localStorage.getItem('access_token'),\n  refreshToken: localStorage.getItem('refresh_token'),\n  loading: false,\n  error: null,\n  isAuthenticated: false\n};\nexport const login = createAsyncThunk('auth/login', async ({\n  username,\n  password\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/user/token/`, {\n      username,\n      password\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Login failed');\n  }\n});\nexport const refreshToken = createAsyncThunk('auth/refreshToken', async (_, {\n  getState,\n  rejectWithValue\n}) => {\n  const state = getState();\n  const refreshToken = state.auth.refreshToken;\n  try {\n    const response = await axios.post('api/user/token/refresh/', {\n      refresh: refreshToken\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Token refresh failed');\n  }\n});\nexport const logout = createAsyncThunk('auth/logout', async (_, {\n  getState,\n  rejectWithValue\n}) => {\n  const state = getState();\n  const refreshToken = state.auth.refreshToken;\n  try {\n    const response = await axios.post('/api/user/my_profile/logout/', {\n      refresh_token: refreshToken\n    });\n    if (response.status === 205) {\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      return;\n    } else {\n      return rejectWithValue('Logout failed');\n    }\n  } catch (error) {\n    return rejectWithValue('Logout failed');\n  }\n});\nexport const register = createAsyncThunk('auth/register', async (registrationData, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post('/api/user/register/', registrationData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    const {\n      access,\n      refresh\n    } = response.data;\n    localStorage.setItem('access_token', access);\n    localStorage.setItem('refresh_token', refresh);\n    return {\n      access,\n      refresh\n    };\n  } catch (error) {\n    return rejectWithValue('Registration failed');\n  }\n});\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    clearAuthState(state) {\n      state.accessToken = null;\n      state.refreshToken = null;\n      state.loading = false;\n      state.error = null;\n      state.isAuthenticated = false;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(login.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(login.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n      state.isAuthenticated = true;\n    }).addCase(login.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(refreshToken.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(refreshToken.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n    }).addCase(refreshToken.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(logout.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(logout.fulfilled, state => {\n      state.loading = false;\n      state.accessToken = null;\n      state.refreshToken = null;\n      state.isAuthenticated = false;\n    }).addCase(logout.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    }).addCase(register.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(register.fulfilled, (state, action) => {\n      state.loading = false;\n      state.accessToken = action.payload.access;\n      state.refreshToken = action.payload.refresh;\n      state.isAuthenticated = true;\n    }).addCase(register.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    });\n  }\n});\nexport const {\n  clearAuthState\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","initialState","accessToken","localStorage","getItem","refreshToken","loading","error","isAuthenticated","login","username","password","rejectWithValue","response","post","import","meta","env","VITE_API_URL","access","refresh","data","setItem","_","getState","state","auth","logout","refresh_token","status","removeItem","register","registrationData","headers","authSlice","name","reducers","clearAuthState","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["D:/pycharm_projects/wander-wave-project/frontend/src/features/authSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n\r\ninterface AuthState {\r\n  accessToken: string | null;\r\n  refreshToken: string | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  isAuthenticated: boolean;\r\n}\r\n\r\nconst initialState: AuthState = {\r\n  accessToken: localStorage.getItem('access_token'),\r\n  refreshToken: localStorage.getItem('refresh_token'),\r\n  loading: false,\r\n  error: null,\r\n  isAuthenticated: false,\r\n};\r\n\r\ntype registerData = {\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  status: string;\r\n  about_me: string;\r\n  avatar: string;\r\n};\r\n\r\nexport const login = createAsyncThunk(\r\n  'auth/login',\r\n  async (\r\n    { username, password }: { username: string; password: string },\r\n    { rejectWithValue },\r\n  ) => {\r\n    try {\r\n      const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/user/token/`, { username, password });\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Login failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const refreshToken = createAsyncThunk(\r\n  'auth/refreshToken',\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState() as { auth: AuthState };\r\n    const refreshToken = state.auth.refreshToken;\r\n\r\n    try {\r\n      const response = await axios.post('api/user/token/refresh/', {\r\n        refresh: refreshToken,\r\n      });\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Token refresh failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const logout = createAsyncThunk(\r\n  'auth/logout',\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState() as { auth: AuthState };\r\n    const refreshToken = state.auth.refreshToken;\r\n\r\n    try {\r\n      const response = await axios.post('/api/user/my_profile/logout/', {\r\n        refresh_token: refreshToken,\r\n      });\r\n      if (response.status === 205) {\r\n        localStorage.removeItem('access_token');\r\n        localStorage.removeItem('refresh_token');\r\n        return;\r\n      } else {\r\n        return rejectWithValue('Logout failed');\r\n      }\r\n    } catch (error) {\r\n      return rejectWithValue('Logout failed');\r\n    }\r\n  },\r\n);\r\n\r\nexport const register = createAsyncThunk(\r\n  'auth/register',\r\n  async (registrationData: registerData, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.post(\r\n        '/api/user/register/',\r\n        registrationData,\r\n        {\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n          },\r\n        },\r\n      );\r\n      const { access, refresh } = response.data;\r\n      localStorage.setItem('access_token', access);\r\n      localStorage.setItem('refresh_token', refresh);\r\n      return { access, refresh };\r\n    } catch (error) {\r\n      return rejectWithValue('Registration failed');\r\n    }\r\n  },\r\n);\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    clearAuthState(state) {\r\n      state.accessToken = null;\r\n      state.refreshToken = null;\r\n      state.loading = false;\r\n      state.error = null;\r\n      state.isAuthenticated = false;\r\n    },\r\n  },\r\n  extraReducers: builder => {\r\n    builder\r\n      .addCase(login.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        login.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n          state.isAuthenticated = true;\r\n        },\r\n      )\r\n      .addCase(login.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(refreshToken.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        refreshToken.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n        },\r\n      )\r\n      .addCase(refreshToken.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(logout.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(logout.fulfilled, state => {\r\n        state.loading = false;\r\n        state.accessToken = null;\r\n        state.refreshToken = null;\r\n        state.isAuthenticated = false;\r\n      })\r\n      .addCase(logout.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      .addCase(register.pending, state => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(\r\n        register.fulfilled,\r\n        (state, action: PayloadAction<{ access: string; refresh: string }>) => {\r\n          state.loading = false;\r\n          state.accessToken = action.payload.access;\r\n          state.refreshToken = action.payload.refresh;\r\n          state.isAuthenticated = true;\r\n        },\r\n      )\r\n      .addCase(register.rejected, (state, action: PayloadAction<any>) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { clearAuthState } = authSlice.actions;\r\nexport default authSlice.reducer;"],"mappings":"AAAA,SAASA,WAAW,EAAEC,gBAAgB,QAAuB,kBAAkB;AAC/E,OAAOC,KAAK,MAAM,OAAO;AAWzB,MAAMC,YAAuB,GAAG;EAC9BC,WAAW,EAAEC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;EACjDC,YAAY,EAAEF,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;EACnDE,OAAO,EAAE,KAAK;EACdC,KAAK,EAAE,IAAI;EACXC,eAAe,EAAE;AACnB,CAAC;AAaD,OAAO,MAAMC,KAAK,GAAGV,gBAAgB,CACnC,YAAY,EACZ,OACE;EAAEW,QAAQ;EAAEC;AAAiD,CAAC,EAC9D;EAAEC;AAAgB,CAAC,KAChB;EACH,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMb,KAAK,CAACc,IAAI,CAAC,GAAGC,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,kBAAkB,EAAE;MAAER,QAAQ;MAAEC;IAAS,CAAC,CAAC;IAC5G,MAAM;MAAEQ,MAAM;MAAEC;IAAQ,CAAC,GAAGP,QAAQ,CAACQ,IAAI;IACzClB,YAAY,CAACmB,OAAO,CAAC,cAAc,EAAEH,MAAM,CAAC;IAC5ChB,YAAY,CAACmB,OAAO,CAAC,eAAe,EAAEF,OAAO,CAAC;IAC9C,OAAO;MAAED,MAAM;MAAEC;IAAQ,CAAC;EAC5B,CAAC,CAAC,OAAOb,KAAK,EAAE;IACd,OAAOK,eAAe,CAAC,cAAc,CAAC;EACxC;AACF,CACF,CAAC;AAED,OAAO,MAAMP,YAAY,GAAGN,gBAAgB,CAC1C,mBAAmB,EACnB,OAAOwB,CAAC,EAAE;EAAEC,QAAQ;EAAEZ;AAAgB,CAAC,KAAK;EAC1C,MAAMa,KAAK,GAAGD,QAAQ,CAAC,CAAwB;EAC/C,MAAMnB,YAAY,GAAGoB,KAAK,CAACC,IAAI,CAACrB,YAAY;EAE5C,IAAI;IACF,MAAMQ,QAAQ,GAAG,MAAMb,KAAK,CAACc,IAAI,CAAC,yBAAyB,EAAE;MAC3DM,OAAO,EAAEf;IACX,CAAC,CAAC;IACF,MAAM;MAAEc,MAAM;MAAEC;IAAQ,CAAC,GAAGP,QAAQ,CAACQ,IAAI;IACzClB,YAAY,CAACmB,OAAO,CAAC,cAAc,EAAEH,MAAM,CAAC;IAC5ChB,YAAY,CAACmB,OAAO,CAAC,eAAe,EAAEF,OAAO,CAAC;IAC9C,OAAO;MAAED,MAAM;MAAEC;IAAQ,CAAC;EAC5B,CAAC,CAAC,OAAOb,KAAK,EAAE;IACd,OAAOK,eAAe,CAAC,sBAAsB,CAAC;EAChD;AACF,CACF,CAAC;AAED,OAAO,MAAMe,MAAM,GAAG5B,gBAAgB,CACpC,aAAa,EACb,OAAOwB,CAAC,EAAE;EAAEC,QAAQ;EAAEZ;AAAgB,CAAC,KAAK;EAC1C,MAAMa,KAAK,GAAGD,QAAQ,CAAC,CAAwB;EAC/C,MAAMnB,YAAY,GAAGoB,KAAK,CAACC,IAAI,CAACrB,YAAY;EAE5C,IAAI;IACF,MAAMQ,QAAQ,GAAG,MAAMb,KAAK,CAACc,IAAI,CAAC,8BAA8B,EAAE;MAChEc,aAAa,EAAEvB;IACjB,CAAC,CAAC;IACF,IAAIQ,QAAQ,CAACgB,MAAM,KAAK,GAAG,EAAE;MAC3B1B,YAAY,CAAC2B,UAAU,CAAC,cAAc,CAAC;MACvC3B,YAAY,CAAC2B,UAAU,CAAC,eAAe,CAAC;MACxC;IACF,CAAC,MAAM;MACL,OAAOlB,eAAe,CAAC,eAAe,CAAC;IACzC;EACF,CAAC,CAAC,OAAOL,KAAK,EAAE;IACd,OAAOK,eAAe,CAAC,eAAe,CAAC;EACzC;AACF,CACF,CAAC;AAED,OAAO,MAAMmB,QAAQ,GAAGhC,gBAAgB,CACtC,eAAe,EACf,OAAOiC,gBAA8B,EAAE;EAAEpB;AAAgB,CAAC,KAAK;EAC7D,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMb,KAAK,CAACc,IAAI,CAC/B,qBAAqB,EACrBkB,gBAAgB,EAChB;MACEC,OAAO,EAAE;QACP,cAAc,EAAE;MAClB;IACF,CACF,CAAC;IACD,MAAM;MAAEd,MAAM;MAAEC;IAAQ,CAAC,GAAGP,QAAQ,CAACQ,IAAI;IACzClB,YAAY,CAACmB,OAAO,CAAC,cAAc,EAAEH,MAAM,CAAC;IAC5ChB,YAAY,CAACmB,OAAO,CAAC,eAAe,EAAEF,OAAO,CAAC;IAC9C,OAAO;MAAED,MAAM;MAAEC;IAAQ,CAAC;EAC5B,CAAC,CAAC,OAAOb,KAAK,EAAE;IACd,OAAOK,eAAe,CAAC,qBAAqB,CAAC;EAC/C;AACF,CACF,CAAC;AAED,MAAMsB,SAAS,GAAGpC,WAAW,CAAC;EAC5BqC,IAAI,EAAE,MAAM;EACZlC,YAAY;EACZmC,QAAQ,EAAE;IACRC,cAAcA,CAACZ,KAAK,EAAE;MACpBA,KAAK,CAACvB,WAAW,GAAG,IAAI;MACxBuB,KAAK,CAACpB,YAAY,GAAG,IAAI;MACzBoB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAAClB,KAAK,GAAG,IAAI;MAClBkB,KAAK,CAACjB,eAAe,GAAG,KAAK;IAC/B;EACF,CAAC;EACD8B,aAAa,EAAEC,OAAO,IAAI;IACxBA,OAAO,CACJC,OAAO,CAAC/B,KAAK,CAACgC,OAAO,EAAEhB,KAAK,IAAI;MAC/BA,KAAK,CAACnB,OAAO,GAAG,IAAI;MACpBmB,KAAK,CAAClB,KAAK,GAAG,IAAI;IACpB,CAAC,CAAC,CACDiC,OAAO,CACN/B,KAAK,CAACiC,SAAS,EACf,CAACjB,KAAK,EAAEkB,MAA0D,KAAK;MACrElB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAACvB,WAAW,GAAGyC,MAAM,CAACC,OAAO,CAACzB,MAAM;MACzCM,KAAK,CAACpB,YAAY,GAAGsC,MAAM,CAACC,OAAO,CAACxB,OAAO;MAC3CK,KAAK,CAACjB,eAAe,GAAG,IAAI;IAC9B,CACF,CAAC,CACAgC,OAAO,CAAC/B,KAAK,CAACoC,QAAQ,EAAE,CAACpB,KAAK,EAAEkB,MAA0B,KAAK;MAC9DlB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAAClB,KAAK,GAAGoC,MAAM,CAACC,OAAO;IAC9B,CAAC,CAAC,CACDJ,OAAO,CAACnC,YAAY,CAACoC,OAAO,EAAEhB,KAAK,IAAI;MACtCA,KAAK,CAACnB,OAAO,GAAG,IAAI;MACpBmB,KAAK,CAAClB,KAAK,GAAG,IAAI;IACpB,CAAC,CAAC,CACDiC,OAAO,CACNnC,YAAY,CAACqC,SAAS,EACtB,CAACjB,KAAK,EAAEkB,MAA0D,KAAK;MACrElB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAACvB,WAAW,GAAGyC,MAAM,CAACC,OAAO,CAACzB,MAAM;MACzCM,KAAK,CAACpB,YAAY,GAAGsC,MAAM,CAACC,OAAO,CAACxB,OAAO;IAC7C,CACF,CAAC,CACAoB,OAAO,CAACnC,YAAY,CAACwC,QAAQ,EAAE,CAACpB,KAAK,EAAEkB,MAA0B,KAAK;MACrElB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAAClB,KAAK,GAAGoC,MAAM,CAACC,OAAO;IAC9B,CAAC,CAAC,CACDJ,OAAO,CAACb,MAAM,CAACc,OAAO,EAAEhB,KAAK,IAAI;MAChCA,KAAK,CAACnB,OAAO,GAAG,IAAI;MACpBmB,KAAK,CAAClB,KAAK,GAAG,IAAI;IACpB,CAAC,CAAC,CACDiC,OAAO,CAACb,MAAM,CAACe,SAAS,EAAEjB,KAAK,IAAI;MAClCA,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAACvB,WAAW,GAAG,IAAI;MACxBuB,KAAK,CAACpB,YAAY,GAAG,IAAI;MACzBoB,KAAK,CAACjB,eAAe,GAAG,KAAK;IAC/B,CAAC,CAAC,CACDgC,OAAO,CAACb,MAAM,CAACkB,QAAQ,EAAE,CAACpB,KAAK,EAAEkB,MAA0B,KAAK;MAC/DlB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAAClB,KAAK,GAAGoC,MAAM,CAACC,OAAO;IAC9B,CAAC,CAAC,CACDJ,OAAO,CAACT,QAAQ,CAACU,OAAO,EAAEhB,KAAK,IAAI;MAClCA,KAAK,CAACnB,OAAO,GAAG,IAAI;MACpBmB,KAAK,CAAClB,KAAK,GAAG,IAAI;IACpB,CAAC,CAAC,CACDiC,OAAO,CACNT,QAAQ,CAACW,SAAS,EAClB,CAACjB,KAAK,EAAEkB,MAA0D,KAAK;MACrElB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAACvB,WAAW,GAAGyC,MAAM,CAACC,OAAO,CAACzB,MAAM;MACzCM,KAAK,CAACpB,YAAY,GAAGsC,MAAM,CAACC,OAAO,CAACxB,OAAO;MAC3CK,KAAK,CAACjB,eAAe,GAAG,IAAI;IAC9B,CACF,CAAC,CACAgC,OAAO,CAACT,QAAQ,CAACc,QAAQ,EAAE,CAACpB,KAAK,EAAEkB,MAA0B,KAAK;MACjElB,KAAK,CAACnB,OAAO,GAAG,KAAK;MACrBmB,KAAK,CAAClB,KAAK,GAAGoC,MAAM,CAACC,OAAO;IAC9B,CAAC,CAAC;EACN;AACF,CAAC,CAAC;AAEF,OAAO,MAAM;EAAEP;AAAe,CAAC,GAAGH,SAAS,CAACY,OAAO;AACnD,eAAeZ,SAAS,CAACa,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}